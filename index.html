<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="utf-8" />
<title>Kaart met CSV-plekken</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<style>
body {
  font-family: Arial, sans-serif;
  margin: 0;
  padding: 0;
  display: flex;
  flex-direction: column;
  height: 100vh;
}
h2 { padding: 10px; margin: 0; }

/* Filters sticky */
.filters {
  position: sticky;
  top: 0;
  background: #f7f7f7;
  border-bottom: 1px solid #ccc;
  padding: 10px 15px;
  display: flex;
  flex-direction: column;
  gap: 5px;
  z-index: 1000;
}
.filter-cats {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
}
.filters label { font-size: 14px; padding: 3px 6px; border-radius:4px; color:white; cursor:pointer; }
.filters label[data-color="camper"] { background:#1f77b4; } /* blauw */
.filters label[data-color="eten"] { background:#ff7f0e; }   /* oranje */
.filters label[data-color="natuur"] { background:#2ca02c; }  /* groen */
.reset-btn { padding:6px 10px; font-size:14px; background:#888; color:white; border:none; border-radius:4px; cursor:pointer; transition:0.2s; }
.reset-btn:hover { background:#555; }

.filter-actions { display:flex; flex-wrap:wrap; gap:10px; margin-top:5px; }
.search-box input { padding:6px; font-size:14px; border:1px solid #aaa; border-radius:4px; flex:1; min-width:150px; }

.main { flex:1; display:flex; min-height:0; gap:1px; }
#map { flex:1; }
#list-container { width:400px; border-left:1px solid #ccc; background:#fafafa; display:flex; flex-direction:column; }
#list-count { font-weight:bold; padding:10px; border-bottom:1px solid #ddd; }
#list { flex:1; overflow-y:auto; padding:10px; }
.place-item { padding:10px; margin-bottom:10px; border:1px solid #ddd; border-radius:8px; background:white; cursor:pointer; transition:0.2s; }
.place-item:hover { background:#f0f8ff; }
.place-item h4 { margin:0 0 5px; font-size:16px; }
.place-item img { max-width:100%; border-radius:6px; margin-top:5px; }

/* Plaats zoeken onder de kaart */
#place-search {
  position: sticky;
  bottom:0;
  background:#f7f7f7;
  border-top:1px solid #ccc;
  padding:10px;
  display:flex;
  gap:10px;
  align-items:center;
  z-index:1000;
  flex-wrap:wrap;
}
#place-search input { flex:1; padding:6px; font-size:14px; border:1px solid #aaa; border-radius:4px; }
#suggestions { position:absolute; background:white; border:1px solid #aaa; max-height:150px; overflow-y:auto; display:none; z-index:1000; width:calc(100% - 120px); top:100%; left:10px; }

@media (max-width:900px){
  .main { flex-direction:column; }
  #list-container { width:100%; border-left:none; border-top:1px solid #ccc; height:40vh; flex-shrink:0; }
  #map { height:60vh; flex:none; }
  #place-search { flex-direction:column; width:100%; }
  #suggestions { width:calc(100% - 20px); left:10px; }
}
@media (max-width:500px){
  #list-container { height:50vh; }
  #map { height:50vh; }
}
</style>
</head>
<body>
<h2>Kaart met interessante plekken üöê- suggesties</h2>

<div class="filters">
  <div class="filter-cats">
    <label data-color="camper"><input type="checkbox" value="camper" checked style="display:none;"> Camperplaatsen</label>
    <label data-color="eten"><input type="checkbox" value="eten" checked style="display:none;"> Restaurants</label>
    <label data-color="natuur"><input type="checkbox" value="natuur" checked style="display:none;"> Natuur</label>
    <button id="reset" class="reset-btn">Toon alles</button>
  </div>
  <div class="filter-actions">
    <div class="search-box">
      <input type="text" id="search" placeholder="Zoek op naam of beschrijving...">
    </div>
  </div>
</div>

<div class="main">
  <div style="flex:1; display:flex; flex-direction:column;">
    <div id="map"></div>

    <div id="place-search">
      <label for="place">Zoek plaats:</label>
      <input type="text" id="place" placeholder="Plaatsnaam">
      <button id="goPlace" class="reset-btn">Ga</button>
      <div id="suggestions"></div>
    </div>
  </div>

  <div id="list-container">
    <div id="list-count">0 plekken gevonden</div>
    <div id="list"></div>
  </div>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://unpkg.com/papaparse@5.3.2/papaparse.min.js"></script>
<script>
var map = L.map('map').setView([52.1,5.3],7);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19, attribution:'¬© OpenStreetMap'}).addTo(map);

var allPlaces = [];
var activeCategories = ["camper","eten","natuur"];
var searchQuery = "";
var activeMarker = null;
var activeItem = null;

var categoryColors = { camper:"blue", eten:"orange", natuur:"green" };
var defaultIcons = {};
var highlightIcon = L.icon({iconUrl:'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-yellow.png', shadowUrl:'https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png', iconSize:[25,41], iconAnchor:[12,41], popupAnchor:[1,-34], shadowSize:[41,41]});

for(let cat in categoryColors){
  defaultIcons[cat] = L.icon({iconUrl:`https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-${categoryColors[cat]}.png`, shadowUrl:'https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png', iconSize:[25,41], iconAnchor:[12,41], popupAnchor:[1,-34], shadowSize:[41,41]});
}

// CSV inladen
Papa.parse("plekken.csv",{download:true, header:true, complete:function(results){
  results.data.forEach((p,i)=>{
    var lat=parseFloat(p.lat); var lon=parseFloat(p.lon);
    if(isNaN(lat)||isNaN(lon)) return;
    var marker=L.marker([lat,lon],{icon:defaultIcons[p.cat]});
    allPlaces.push({data:p, marker:marker, lat:lat, lon:lon, index:i});
  });
  renderPlaces();
}});

function renderPlaces(){
  var listDiv=document.getElementById("list");
  var countDiv=document.getElementById("list-count");
  listDiv.innerHTML="";
  allPlaces.forEach(place=>{
    let cat=place.data.cat||""; let name=place.data.name||""; let desc=place.data.desc||"";
    if(!activeCategories.includes(cat)){ map.removeLayer(place.marker); return; }
    let searchText=(name+" "+desc).toLowerCase();
    if(searchQuery && !searchText.includes(searchQuery.toLowerCase())){ map.removeLayer(place.marker); return; }
    place.marker.addTo(map);

    var item=document.createElement("div");
    item.className="place-item";
    item.id="place-"+place.index;
    item.innerHTML=`<h4>${name}</h4><p><em>${cat}</em></p><p>${desc}</p><a href="${place.data.link}" target="_blank">Website</a><br>${place.data.img?`<img src="${place.data.img}" alt="${name}">`:""}`;
    item.addEventListener("click",()=>{selectPlace(place);});
    listDiv.appendChild(item);

    place.marker.on("click",()=>{selectPlace(place);});
  });
  filterListByMapBounds();
}

function selectPlace(place){
  if(activeMarker) activeMarker.setIcon(defaultIcons[activeMarker.cat]);
  if(activeItem) activeItem.style.backgroundColor="white";
  activeMarker=place.marker; activeMarker.setIcon(highlightIcon);
  activeMarker.cat=place.data.cat;
  activeItem=document.getElementById("place-"+place.index);
  if(activeItem){activeItem.style.backgroundColor="#fffa90"; activeItem.scrollIntoView({behavior:"smooth", block:"center"});}
}

// Filter lijst op zichtbare markers
function filterListByMapBounds(){
  const bounds=map.getBounds();
  let visibleCount=0;
  allPlaces.forEach(place=>{
    const item=document.getElementById("place-"+place.index);
    if(!item) return;
    if(map.hasLayer(place.marker) && bounds.contains([place.lat,place.lon])){
      item.style.display="block"; visibleCount++;
    } else { item.style.display="none"; }
  });
  document.getElementById("list-count").textContent=visibleCount+" plek"+(visibleCount===1?"":"ken")+" gevonden";
}

// Filters en search
document.querySelectorAll('.filter-cats input[type=checkbox]').forEach(cb=>{
  cb.addEventListener('change',()=>{
    let cat=cb.value;
    if(cb.checked){if(!activeCategories.includes(cat)) activeCategories.push(cat);}
    else{activeCategories=activeCategories.filter(c=>c!==cat);}
    renderPlaces();
  });
});
document.getElementById("search").addEventListener("input", e=>{searchQuery=e.target.value; renderPlaces();});
document.getElementById("reset").addEventListener("click", ()=>{
  activeCategories=["camper","eten","natuur"];
  document.querySelectorAll('.filter-cats input[type=checkbox]').forEach(cb=>cb.checked=true);
  searchQuery=""; document.getElementById("search").value="";
  if(activeMarker){activeMarker.setIcon(defaultIcons[activeMarker.cat]); activeMarker=null;}
  if(activeItem){activeItem.style.backgroundColor="white"; activeItem=null;}
  renderPlaces(); zoomToAll();
});

// Zoom naar alle markers
function zoomToAll(){
  let visibleMarkers=allPlaces.filter(p=>map.hasLayer(p.marker)).map(p=>p.marker.getLatLng());
  if(visibleMarkers.length>0){ map.fitBounds(L.latLngBounds(visibleMarkers),{padding:[40,40]}); }
}

// Plaats zoeken met autosuggest
const placeInput=document.getElementById("place");
const suggestionsDiv=document.getElementById("suggestions");

placeInput.addEventListener("input",()=>{
  const query=placeInput.value.trim();
  if(!query){ suggestionsDiv.style.display="none"; return; }
  fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}&addressdetails=1&limit=5`)
    .then(res=>res.json()).then(data=>{
      suggestionsDiv.innerHTML="";
      if(!data||data.length===0){ suggestionsDiv.style.display="none"; return; }
      data.forEach(place=>{
        const div=document.createElement("div");
        div.style.padding="5px"; div.style.cursor="pointer";
        div.textContent=place.display_name;
        div.addEventListener("click",()=>{
          placeInput.value=place.display_name;
          suggestionsDiv.style.display="none";
          goToPlace(place);
        });
        suggestionsDiv.appendChild(div);
      });
      suggestionsDiv.style.display="block";
    });
});
document.addEventListener("click",(e)=>{
  if(!placeInput.contains(e.target)&&!suggestionsDiv.contains(e.target)) suggestionsDiv.style.display="none";
});
document.getElementById("goPlace").addEventListener("click",()=>{goToPlace();});
placeInput.addEventListener("keypress", e=>{if(e.key==="Enter"){e.preventDefault(); goToPlace();}});

function goToPlace(selectedPlace){
  let lat, lon;
  if(selectedPlace){ lat=parseFloat(selectedPlace.lat); lon=parseFloat(selectedPlace.lon); zoomToPlace(lat,lon);}
  else{
    const name=placeInput.value.trim();
    if(!name){alert("Vul een plaatsnaam in"); return;}
    fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(name)}`)
      .then(res=>res.json()).then(data=>{
        if(!data||data.length===0){alert("Plaats niet gevonden"); return;}
        lat=parseFloat(data[0].lat); lon=parseFloat(data[0].lon);
        zoomToPlace(lat,lon);
      }).catch(err=>{console.error(err); alert("Fout bij ophalen locatie");});
  }
}

function zoomToPlace(lat, lon){
  const latOffset=25/111;
  const lonOffset=25/(111*Math.cos(lat*Math.PI/180));
  map.fitBounds([[lat-latOffset,lon-lonOffset],[lat+latOffset,lon+lonOffset]]);
}

// Update lijst bij move
map.on("moveend", filterListByMapBounds);
</script>
</body>
</html>

